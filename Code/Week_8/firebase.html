<!DOCTYPE html>
<html>
  <head>

    <meta charset="utf-8">
    <title>Firebase Chat Client</title>

    <script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>
    <link rel="stylesheet" href="firebase.css" media="screen" charset="utf-8">

  </head>
<body>

  <main>
    <form id="messages">
      <input type="text" id="chat-text" placeholder="Type message here">
      <button type="submit">Enter</button>
    </form>

    <ul id="posted-chats">
      </ul>
  </main>







  </body>

  <script>

  // Connect to the Firebase DB
  var firebase = new Firebase("https://blinding-inferno-7422.firebaseio.com");

  // Event listener to list to events (chats posted to Firesbase)
  var form = document.querySelector("#messages"); //this is the form
  var input = document.querySelector("#chat-text"); //this is the input (text)
  var list = document.querySelector("#posted-chats"); //this is the UL



  // Run whenSubmitted program when submit button is pushed
  function whenSubmitted(event) {
    event.preventDefault();

    // Ask for username
    var username = prompt("Please input a username?");

    // Ask for a username + local storage
    // var username = localStorage.getItem("username");
    //
    // if (username == null) {
    //   username = prompt("Please input a username?");
    //   localStorage.setItem("username", username);
    // }

    var inputText = input.value;



    // log to ensure working
    console.log(username);
    console.log(inputText);

    // Save the message
    firebase.push({ 'User' : username, 'Message' : inputText});

    // Reset form
    form.reset();

    // add chat to page
    var listItem = document.createElement("li");
    listItem.textContent = inputText;
    list.appendChild(listItem);
    listItem.classList.add("chatbox");

    // add username to page
    var nameToken = document.createElement("li");
    nameToken.textContent = "Posted by:  " + username;
    list.appendChild(nameToken);
    nameToken.classList.add("namefield");

  }

// eventListener in Firebase form, calling a function upon event (child_added)
firebase.on("child_added",createMessageFromFirebase)

// function to create message
  function createMessageFromFirebase(snapshot) {

    var messageData = snapshot.val();
    // chat
    var externalMessage = document.createElement("li");
    externalMessage.textContent = messageData.messageBody;
    list.appendChild(externalMessage);
    externalMessage.classList.add("chatbox");
    // username
    var externalUser = document.createElement("li");
    externalUser.textContent = "Posted by:  " + messageData.username;
    list.appendChild(externalUser);
    externalUser.classList.add("namefield");

}






  form.addEventListener("submit", whenSubmitted); //when the Submit button in the form is pressed, run 'whenSubmitted'

  </script>

</html>
